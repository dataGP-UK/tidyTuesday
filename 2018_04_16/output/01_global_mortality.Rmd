---
title: "Global Mortality"
author: "dataGP-UK"
date: "13/07/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(here)
```

```{r load_data}
load("2018_04_16/data/grouped_mortality.rda")
```

```{r }
# filter data by regions
## select regions of interest and create vector to subset dataset with
regions <- c(2,4,5,8,9,14,18,19,20,21,22,25,27)
regions <- unique(grouped_mortality$country)[regions]

# subset dataset using regions vector to filter
regional_mortality <- 
  grouped_mortality %>% 
  filter(country %in% regions)

# create a list of causes of death grouped into broader areas
## create vector of all mortality variable names
causes <- 
  regional_mortality %>% 
  select(-c(1:3)) %>% 
  names()
## create list by subsetting causes vector
all_causes <- list("chronic_disease" = causes[c(1,3,4,5,10,12,13,22)], 
                "cancers" = causes[2], 
                "infectious_disease" = causes[c(6,8,11,14,16,19,24,26)], 
                "neonatal_maternal" = causes[c(7,21)], 
                "unnatural" = causes[c(9,15,17,18,20,23,25,27,28,29,30,31)], 
                "unspecified" = causes[32])

# manipulate regional_mortality df to show mortality rates for each group from all_causes list.
## create vector to use to select columns with grouped data 
new_groups <- names(all_causes)
## use each item of all_causes list to subset dataframe prior to rowSums()
regional_mortality<- 
  regional_mortality %>% 
  mutate(chronic_disease = rowSums(.[all_causes[["chronic_disease"]]]),
         infectious_disease = rowSums(.[all_causes[["infectious_disease"]]]),
         neonatal_maternal = rowSums(.[all_causes[["neonatal_maternal"]]]),
         unnatural = rowSums(.[all_causes[["unnatural"]]], na.rm = TRUE)) %>% 
  select(country, year, new_groups)
```
